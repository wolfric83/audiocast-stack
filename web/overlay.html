<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Now Playing Overlay</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: transparent;
    width: 100%;
    height: 100%;
  }

  #container {
    position: absolute;
    max-width: 90%;
    pointer-events: none;
  }

  /* Corner positioning classes */
  .top-left    { top: 0;    left: 0;    }
  .top-right   { top: 0;    right: 0;   text-align: right; }
  .bottom-left { bottom: 0; left: 0;    }
  .bottom-right{ bottom: 0; right: 0;   text-align: right; }
  .center {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }

  #wrap {
    font-family: Arial, sans-serif;
    color: white;
    text-shadow: 0 2px 8px rgba(0,0,0,.8);
    padding: 20px;
  }

  #title  { font-size: 36px; font-weight: 700; }
  #artist { font-size: 28px; font-weight: 600; opacity: .95; margin-top: 6px; }
  #album  { font-size: 22px; font-weight: 500; opacity: .90; margin-top: 6px; }
  #track  { font-size: 18px; font-weight: 500; opacity: .85; margin-top: 4px; }
</style>
</head>
<body>
  <div id="container">
    <div id="wrap">
      <div id="title">Loadingâ€¦</div>
      <div id="artist" style="display:none"></div>
      <div id="album"  style="display:none"></div>
      <div id="track"  style="display:none"></div>
    </div>
  </div>

<script>
  function setLine(id, value) {
    const el = document.getElementById(id);
    const v = (value ?? "").toString().trim();
    if (v) {
      el.textContent = v;
      el.style.display = "";
    } else {
      el.textContent = "";
      el.style.display = "none";
    }
  }

  function applyPosition() {
    const params = new URLSearchParams(window.location.search);
    const pos = params.get("pos") || "bottom-left";
    const container = document.getElementById("container");

    const allowed = [
      "top-left",
      "top-right",
      "bottom-left",
      "bottom-right",
      "center"
    ];

    container.className = allowed.includes(pos) ? pos : "bottom-left";
  }

  async function refresh() {
    try {
      const r = await fetch("/nowplaying.json", { cache: "no-store" });
      if (!r.ok) throw new Error("HTTP " + r.status);
      const m = await r.json();

      document.getElementById("title").textContent =
        (m.title || "").trim() || "Playing";

      setLine("artist", m.artist);
      setLine("album", m.album);
      setLine("track",
        m.tracknumber ? `Track ${m.tracknumber}` : ""
      );

    } catch {
      document.getElementById("title").textContent = "Metadata error";
      setLine("artist", "");
      setLine("album", "");
      setLine("track", "");
    }
  }

document.addEventListener("DOMContentLoaded", () => {
  applyPosition();
  refresh();
  setInterval(refresh, 1000);
});
</script>



</body>
</html>
